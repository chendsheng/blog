(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../htmlmixed/htmlmixed"],e);else e(CodeMirror)})(function(c){"use strict";c.defineMode("htmlembedded",function(e,t){var n=t.scriptStartRegex||/^<%/i,i=t.scriptEndRegex||/^%>/i;var r,o;function a(e,t){if(e.match(n,false)){t.token=d;return r.token(e,t.scriptState)}else return o.token(e,t.htmlState)}function d(e,t){if(e.match(i,false)){t.token=a;return o.token(e,t.htmlState)}else return r.token(e,t.scriptState)}return{startState:function(){r=r||c.getMode(e,t.scriptingModeSpec);o=o||c.getMode(e,"htmlmixed");return{token:t.startOpen?d:a,htmlState:c.startState(o),scriptState:c.startState(r)}},token:function(e,t){return t.token(e,t)},indent:function(e,t){if(e.token==a)return o.indent(e.htmlState,t);else if(r.indent)return r.indent(e.scriptState,t)},copyState:function(e){return{token:e.token,htmlState:c.copyState(o,e.htmlState),scriptState:c.copyState(r,e.scriptState)}},innerMode:function(e){if(e.token==d)return{state:e.scriptState,mode:r};else return{state:e.htmlState,mode:o}}}},"htmlmixed");c.defineMIME("application/x-ejs",{name:"htmlembedded",scriptingModeSpec:"javascript"});c.defineMIME("application/x-aspx",{name:"htmlembedded",scriptingModeSpec:"text/x-csharp"});c.defineMIME("application/x-jsp",{name:"htmlembedded",scriptingModeSpec:"text/x-java"});c.defineMIME("application/x-erb",{name:"htmlembedded",scriptingModeSpec:"ruby"})});