(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("ruby",function(a){function e(e){var t={};for(var n=0,r=e.length;n<r;++n)t[e[n]]=true;return t}var o=e(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"]);var f=e(["def","class","case","for","while","module","then","catch","loop","proc","begin"]);var l=e(["end","until"]);var c={"[":"]","{":"}","(":")"};var p;function k(e,t,n){n.tokenize.push(e);return e(t,n)}function u(e,t){p=null;if(e.sol()&&e.match("=begin")&&e.eol()){t.tokenize.push(v);return"comment"}if(e.eatSpace())return null;var n=e.next(),r;if(n=="`"||n=="'"||n=='"'){return k(h(n,"string",n=='"'||n=="`"),e,t)}else if(n=="/"){var i=e.current().length;if(e.skipTo("/")){var a=e.current().length;e.backUp(e.current().length-i);var o=0;while(e.current().length<a){var f=e.next();if(f=="(")o+=1;else if(f==")")o-=1;if(o<0)break}e.backUp(e.current().length-i);if(o==0)return k(h(n,"string-2",true),e,t)}return"operator"}else if(n=="%"){var l="string",u=true;if(e.eat("s"))l="atom";else if(e.eat(/[WQ]/))l="string";else if(e.eat(/[r]/))l="string-2";else if(e.eat(/[wxq]/)){l="string";u=false}var s=e.eat(/[^\w\s=]/);if(!s)return"operator";if(c.propertyIsEnumerable(s))s=c[s];return k(h(s,l,u,true),e,t)}else if(n=="#"){e.skipToEnd();return"comment"}else if(n=="<"&&(r=e.match(/^<-?[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/))){return k(m(r[1]),e,t)}else if(n=="0"){if(e.eat("x"))e.eatWhile(/[\da-fA-F]/);else if(e.eat("b"))e.eatWhile(/[01]/);else e.eatWhile(/[0-7]/);return"number"}else if(/\d/.test(n)){e.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/);return"number"}else if(n=="?"){while(e.match(/^\\[CM]-/)){}if(e.eat("\\"))e.eatWhile(/\w/);else e.next();return"string"}else if(n==":"){if(e.eat("'"))return k(h("'","atom",false),e,t);if(e.eat('"'))return k(h('"',"atom",true),e,t);if(e.eat(/[\<\>]/)){e.eat(/[\<\>]/);return"atom"}if(e.eat(/[\+\-\*\/\&\|\:\!]/)){return"atom"}if(e.eat(/[a-zA-Z$@_\xa1-\uffff]/)){e.eatWhile(/[\w$\xa1-\uffff]/);e.eat(/[\?\!\=]/);return"atom"}return"operator"}else if(n=="@"&&e.match(/^@?[a-zA-Z_\xa1-\uffff]/)){e.eat("@");e.eatWhile(/[\w\xa1-\uffff]/);return"variable-2"}else if(n=="$"){if(e.eat(/[a-zA-Z_]/)){e.eatWhile(/[\w]/)}else if(e.eat(/\d/)){e.eat(/\d/)}else{e.next()}return"variable-3"}else if(/[a-zA-Z_\xa1-\uffff]/.test(n)){e.eatWhile(/[\w\xa1-\uffff]/);e.eat(/[\?\!]/);if(e.eat(":"))return"atom";return"ident"}else if(n=="|"&&(t.varList||t.lastTok=="{"||t.lastTok=="do")){p="|";return null}else if(/[\(\)\[\]{}\\;]/.test(n)){p=n;return null}else if(n=="-"&&e.eat(">")){return"arrow"}else if(/[=+\-\/*:\.^%<>~|]/.test(n)){var d=e.eatWhile(/[=+\-\/*:\.^%<>~|]/);if(n=="."&&!d)p=".";return"operator"}else{return null}}function s(n){if(!n)n=1;return function(e,t){if(e.peek()=="}"){if(n==1){t.tokenize.pop();return t.tokenize[t.tokenize.length-1](e,t)}else{t.tokenize[t.tokenize.length-1]=s(n-1)}}else if(e.peek()=="{"){t.tokenize[t.tokenize.length-1]=s(n+1)}return u(e,t)}}function d(){var n=false;return function(e,t){if(n){t.tokenize.pop();return t.tokenize[t.tokenize.length-1](e,t)}n=true;return u(e,t)}}function h(i,a,o,f){return function(e,t){var n=false,r;if(t.context.type==="read-quoted-paused"){t.context=t.context.prev;e.eat("}")}while((r=e.next())!=null){if(r==i&&(f||!n)){t.tokenize.pop();break}if(o&&r=="#"&&!n){if(e.eat("{")){if(i=="}"){t.context={prev:t.context,type:"read-quoted-paused"}}t.tokenize.push(s());break}else if(/[@\$]/.test(e.peek())){t.tokenize.push(d());break}}n=!n&&r=="\\"}return a}}function m(n){return function(e,t){if(e.match(n))t.tokenize.pop();else e.skipToEnd();return"string"}}function v(e,t){if(e.sol()&&e.match("=end")&&e.eol())t.tokenize.pop();e.skipToEnd();return"comment"}return{startState:function(){return{tokenize:[u],indented:0,context:{type:"top",indented:-a.indentUnit},continuedLine:false,lastTok:null,varList:false}},token:function(e,t){if(e.sol())t.indented=e.indentation();var n=t.tokenize[t.tokenize.length-1](e,t),r;var i=p;if(n=="ident"){var a=e.current();n=t.lastTok=="."?"property":o.propertyIsEnumerable(e.current())?"keyword":/^[A-Z]/.test(a)?"tag":t.lastTok=="def"||t.lastTok=="class"||t.varList?"def":"variable";if(n=="keyword"){i=a;if(f.propertyIsEnumerable(a))r="indent";else if(l.propertyIsEnumerable(a))r="dedent";else if((a=="if"||a=="unless")&&e.column()==e.indentation())r="indent";else if(a=="do"&&t.context.indented<t.indented)r="indent"}}if(p||n&&n!="comment")t.lastTok=i;if(p=="|")t.varList=!t.varList;if(r=="indent"||/[\(\[\{]/.test(p))t.context={prev:t.context,type:p||n,indented:t.indented};else if((r=="dedent"||/[\)\]\}]/.test(p))&&t.context.prev)t.context=t.context.prev;if(e.eol())t.continuedLine=p=="\\"||n=="operator";return n},indent:function(e,t){if(e.tokenize[e.tokenize.length-1]!=u)return 0;var n=t&&t.charAt(0);var r=e.context;var i=r.type==c[n]||r.type=="keyword"&&/^(?:end|until|else|elsif|when|rescue)\b/.test(t);return r.indented+(i?0:a.indentUnit)+(e.continuedLine?a.indentUnit:0)},electricChars:"}de",lineComment:"#"}});e.defineMIME("text/x-ruby","ruby")});