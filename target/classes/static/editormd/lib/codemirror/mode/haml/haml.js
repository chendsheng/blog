(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],e);else e(CodeMirror)})(function(t){"use strict";t.defineMode("haml",function(e){var i=t.getMode(e,{name:"htmlmixed"});var n=t.getMode(e,"ruby");function r(i){return function(e,t){var n=e.peek();if(n==i&&t.rubyState.tokenize.length==1){e.next();t.tokenize=u;return"closeAttributeTag"}else{return o(e,t)}}}function o(e,t){if(e.match("-#")){e.skipToEnd();return"comment"}return n.token(e,t.rubyState)}function u(e,t){var n=e.peek();if(t.previousToken.style=="comment"){if(t.indented>t.previousToken.indented){e.skipToEnd();return"commentLine"}}if(t.startOfLine){if(n=="!"&&e.match("!!")){e.skipToEnd();return"tag"}else if(e.match(/^%[\w:#\.]+=/)){t.tokenize=o;return"hamlTag"}else if(e.match(/^%[\w:]+/)){return"hamlTag"}else if(n=="/"){e.skipToEnd();return"comment"}}if(t.startOfLine||t.previousToken.style=="hamlTag"){if(n=="#"||n=="."){e.match(/[\w-#\.]*/);return"hamlAttribute"}}if(t.startOfLine&&!e.match("--\x3e",false)&&(n=="="||n=="-")){t.tokenize=o;return t.tokenize(e,t)}if(t.previousToken.style=="hamlTag"||t.previousToken.style=="closeAttributeTag"||t.previousToken.style=="hamlAttribute"){if(n=="("){t.tokenize=r(")");return t.tokenize(e,t)}else if(n=="{"){t.tokenize=r("}");return t.tokenize(e,t)}}return i.token(e,t.htmlState)}return{startState:function(){var e=i.startState();var t=n.startState();return{htmlState:e,rubyState:t,indented:0,previousToken:{style:null,indented:0},tokenize:u}},copyState:function(e){return{htmlState:t.copyState(i,e.htmlState),rubyState:t.copyState(n,e.rubyState),indented:e.indented,previousToken:e.previousToken,tokenize:e.tokenize}},token:function(e,t){if(e.sol()){t.indented=e.indentation();t.startOfLine=true}if(e.eatSpace())return null;var n=t.tokenize(e,t);t.startOfLine=false;if(n&&n!="commentLine"){t.previousToken={style:n,indented:t.indented}}if(e.eol()&&t.tokenize==o){e.backUp(1);var i=e.peek();e.next();if(i&&i!=","){t.tokenize=u}}if(n=="hamlTag"){n="tag"}else if(n=="commentLine"){n="comment"}else if(n=="hamlAttribute"){n="attribute"}else if(n=="closeAttributeTag"){n=null}return n}}},"htmlmixed","ruby");t.defineMIME("text/x-haml","haml")});