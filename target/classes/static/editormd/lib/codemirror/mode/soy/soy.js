(function(t){if(typeof exports=="object"&&typeof module=="object")t(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../htmlmixed/htmlmixed"],t);else t(CodeMirror)})(function(s){"use strict";var c=["template","literal","msg","fallbackmsg","let","if","elseif","else","switch","case","default","foreach","ifempty","for","call","param","deltemplate","delcall","log"];s.defineMode("soy",function(i){var t=s.getMode(i,"text/plain");var l={html:s.getMode(i,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:false}),attributes:t,text:t,uri:t,css:s.getMode(i,"text/css"),js:s.getMode(i,{name:"text/javascript",statementIndent:2*i.indentUnit})};function r(t){return t[t.length-1]}function o(t,e,n){var a=t.string;var i=n.exec(a.substr(t.pos));if(i){t.string=a.substr(0,t.pos+i.index)}var l=t.hideFirstChars(e.indent,function(){return e.localMode.token(t,e.localState)});t.string=a;return l}return{startState:function(){return{kind:[],kindTag:[],soyState:[],indent:0,localMode:l.html,localState:s.startState(l.html)}},copyState:function(t){return{tag:t.tag,kind:t.kind.concat([]),kindTag:t.kindTag.concat([]),soyState:t.soyState.concat([]),indent:t.indent,localMode:t.localMode,localState:s.copyState(t.localMode,t.localState)}},token:function(t,e){var n;switch(r(e.soyState)){case"comment":if(t.match(/^.*?\*\//)){e.soyState.pop()}else{t.skipToEnd()}return"comment";case"variable":if(t.match(/^}/)){e.indent-=2*i.indentUnit;e.soyState.pop();return"variable-2"}t.next();return null;case"tag":if(t.match(/^\/?}/)){if(e.tag=="/template"||e.tag=="/deltemplate")e.indent=0;else e.indent-=(t.current()=="/}"||c.indexOf(e.tag)==-1?2:1)*i.indentUnit;e.soyState.pop();return"keyword"}else if(t.match(/^(\w+)(?==)/)){if(t.current()=="kind"&&(n=t.match(/^="([^"]+)/,false))){var a=n[1];e.kind.push(a);e.kindTag.push(e.tag);e.localMode=l[a]||l.html;e.localState=s.startState(e.localMode)}return"attribute"}else if(t.match(/^"/)){e.soyState.push("string");return"string"}t.next();return null;case"literal":if(t.match(/^(?=\{\/literal})/)){e.indent-=i.indentUnit;e.soyState.pop();return this.token(t,e)}return o(t,e,/\{\/literal}/);case"string":if(t.match(/^.*?"/)){e.soyState.pop()}else{t.skipToEnd()}return"string"}if(t.match(/^\/\*/)){e.soyState.push("comment");return"comment"}else if(t.match(t.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)){return"comment"}else if(t.match(/^\{\$\w*/)){e.indent+=2*i.indentUnit;e.soyState.push("variable");return"variable-2"}else if(t.match(/^\{literal}/)){e.indent+=i.indentUnit;e.soyState.push("literal");return"keyword"}else if(n=t.match(/^\{([\/@\\]?\w*)/)){if(n[1]!="/switch")e.indent+=(/^(\/|(else|elseif|case|default)$)/.test(n[1])&&e.tag!="switch"?1:2)*i.indentUnit;e.tag=n[1];if(e.tag=="/"+r(e.kindTag)){e.kind.pop();e.kindTag.pop();e.localMode=l[r(e.kind)]||l.html;e.localState=s.startState(e.localMode)}e.soyState.push("tag");return"keyword"}return o(t,e,/\{|\s+\/\/|\/\*/)},indent:function(t,e){var n=t.indent,a=r(t.soyState);if(a=="comment")return s.Pass;if(a=="literal"){if(/^\{\/literal}/.test(e))n-=i.indentUnit}else{if(/^\s*\{\/(template|deltemplate)\b/.test(e))return 0;if(/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(e))n-=i.indentUnit;if(t.tag!="switch"&&/^\{(case|default)\b/.test(e))n-=i.indentUnit;if(/^\{\/switch\b/.test(e))n-=i.indentUnit}if(n&&t.localMode.indent)n+=t.localMode.indent(t.localState,e);return n},innerMode:function(t){if(t.soyState.length&&r(t.soyState)!="literal")return null;else return{state:t.localState,mode:t.localMode}},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",fold:"indent"}},"htmlmixed");s.registerHelper("hintWords","soy",c.concat(["delpackage","namespace","alias","print","css","debugger"]));s.defineMIME("text/x-soy","soy")});