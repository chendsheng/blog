(function(t){if(typeof exports=="object"&&typeof module=="object")t(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],t);else t(CodeMirror)})(function(u){"use strict";u.defineMode("htmlmixed",function(t,e){var c=u.getMode(t,{name:"xml",htmlMode:true,multilineTagIndentFactor:e.multilineTagIndentFactor,multilineTagIndentPastTag:e.multilineTagIndentPastTag});var i=u.getMode(t,"css");var s=[],a=e&&e.scriptTypes;s.push({matches:/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,mode:u.getMode(t,"javascript")});if(a)for(var l=0;l<a.length;++l){var o=a[l];s.push({matches:o.matches,mode:o.mode&&u.getMode(t,o.mode)})}s.push({matches:/./,mode:u.getMode(t,"text/plain")});function n(t,e){var a=e.htmlState.tagName;if(a)a=a.toLowerCase();var l=c.token(t,e.htmlState);if(a=="script"&&/\btag\b/.test(l)&&t.current()==">"){var o=t.string.slice(Math.max(0,t.pos-100),t.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i);o=o?o[1]:"";if(o&&/[\"\']/.test(o.charAt(0)))o=o.slice(1,o.length-1);for(var n=0;n<s.length;++n){var r=s[n];if(typeof r.matches=="string"?o==r.matches:r.matches.test(o)){if(r.mode){e.token=m;e.localMode=r.mode;e.localState=r.mode.startState&&r.mode.startState(c.indent(e.htmlState,""))}break}}}else if(a=="style"&&/\btag\b/.test(l)&&t.current()==">"){e.token=d;e.localMode=i;e.localState=i.startState(c.indent(e.htmlState,""))}return l}function r(t,e,a){var l=t.current();var o=l.search(e),n;if(o>-1)t.backUp(l.length-o);else if(n=l.match(/<\/?$/)){t.backUp(l.length);if(!t.match(e,false))t.match(l)}return a}function m(t,e){if(t.match(/^<\/\s*script\s*>/i,false)){e.token=n;e.localState=e.localMode=null;return null}return r(t,/<\/\s*script\s*>/,e.localMode.token(t,e.localState))}function d(t,e){if(t.match(/^<\/\s*style\s*>/i,false)){e.token=n;e.localState=e.localMode=null;return null}return r(t,/<\/\s*style\s*>/,i.token(t,e.localState))}return{startState:function(){var t=c.startState();return{token:n,localMode:null,localState:null,htmlState:t}},copyState:function(t){if(t.localState)var e=u.copyState(t.localMode,t.localState);return{token:t.token,localMode:t.localMode,localState:e,htmlState:u.copyState(c,t.htmlState)}},token:function(t,e){return e.token(t,e)},indent:function(t,e){if(!t.localMode||/^\s*<\//.test(e))return c.indent(t.htmlState,e);else if(t.localMode.indent)return t.localMode.indent(t.localState,e);else return u.Pass},innerMode:function(t){return{state:t.localState||t.htmlState,mode:t.localMode||c}}}},"xml","javascript","css");u.defineMIME("text/html","htmlmixed")});