(function(t){if(typeof exports=="object"&&typeof module=="object")t(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],t);else t(CodeMirror)})(function(f){"use strict";var m="CodeMirror-lint-markers";function a(t,e){var n=document.createElement("div");n.className="CodeMirror-lint-tooltip";n.appendChild(e.cloneNode(true));document.body.appendChild(n);function o(t){if(!n.parentNode)return f.off(document,"mousemove",o);n.style.top=Math.max(0,t.clientY-n.offsetHeight-5)+"px";n.style.left=t.clientX+5+"px"}f.on(document,"mousemove",o);o(t);if(n.style.opacity!=null)n.style.opacity=1;return n}function e(t){if(t.parentNode)t.parentNode.removeChild(t)}function s(t){if(!t.parentNode)return;if(t.style.opacity==null)e(t);t.style.opacity=0;setTimeout(function(){e(t)},600)}function u(t,e,n){var o=a(t,e);function r(){f.off(n,"mouseout",r);if(o){s(o);o=null}}var i=setInterval(function(){if(o)for(var t=n;;t=t.parentNode){if(t&&t.nodeType==11)t=t.host;if(t==document.body)return;if(!t){r();break}}if(!o)return clearInterval(i)},400);f.on(n,"mouseout",r)}function l(e,t,n){this.marked=[];this.options=t;this.timeout=null;this.hasGutter=n;this.onMouseOver=function(t){o(e,t)}}function c(t,e){if(e instanceof Function)return{getAnnotations:e};if(!e||e===true)e={};if(!e.getAnnotations)e.getAnnotations=t.getHelper(f.Pos(0,0),"lint");if(!e.getAnnotations)throw new Error("Required option 'getAnnotations' missing (lint addon)");return e}function d(t){var e=t.state.lint;if(e.hasGutter)t.clearGutter(m);for(var n=0;n<e.marked.length;++n)e.marked[n].clear();e.marked.length=0}function p(e,t,n,o){var r=document.createElement("div"),i=r;r.className="CodeMirror-lint-marker-"+t;if(n){i=r.appendChild(document.createElement("div"));i.className="CodeMirror-lint-marker-multiple"}if(o!=false)f.on(i,"mouseover",function(t){u(t,e,i)});return r}function v(t,e){if(t=="error")return t;else return e}function g(t){var e=[];for(var n=0;n<t.length;++n){var o=t[n],r=o.from.line;(e[r]||(e[r]=[])).push(o)}return e}function h(t){var e=t.severity;if(!e)e="error";var n=document.createElement("div");n.className="CodeMirror-lint-message-"+e;n.appendChild(document.createTextNode(t.message));return n}function y(t){var e=t.state.lint,n=e.options;var o=n.options||n;if(n.async||n.getAnnotations.async)n.getAnnotations(t.getValue(),r,o,t);else r(t,n.getAnnotations(t.getValue(),o,t))}function r(t,e){d(t);var n=t.state.lint,o=n.options;var r=g(e);for(var i=0;i<r.length;++i){var a=r[i];if(!a)continue;var f=null;var s=n.hasGutter&&document.createDocumentFragment();for(var u=0;u<a.length;++u){var l=a[u];var c=l.severity;if(!c)c="error";f=v(f,c);if(o.formatAnnotation)l=o.formatAnnotation(l);if(n.hasGutter)s.appendChild(h(l));if(l.to)n.marked.push(t.markText(l.from,l.to,{className:"CodeMirror-lint-mark-"+c,__annotation:l}))}if(n.hasGutter)t.setGutterMarker(i,m,p(s,f,a.length>1,n.options.tooltips))}if(o.onUpdateLinting)o.onUpdateLinting(e,r,t)}function C(t){var e=t.state.lint;clearTimeout(e.timeout);e.timeout=setTimeout(function(){y(t)},e.options.delay||500)}function k(t,e){var n=e.target||e.srcElement;u(e,h(t),n)}function o(t,e){var n=e.target||e.srcElement;if(!/\bCodeMirror-lint-mark-/.test(n.className))return;var o=n.getBoundingClientRect(),r=(o.left+o.right)/2,i=(o.top+o.bottom)/2;var a=t.findMarksAt(t.coordsChar({left:r,top:i},"client"));for(var f=0;f<a.length;++f){var s=a[f].__annotation;if(s)return k(s,e)}}f.defineOption("lint",false,function(t,e,n){if(n&&n!=f.Init){d(t);t.off("change",C);f.off(t.getWrapperElement(),"mouseover",t.state.lint.onMouseOver);delete t.state.lint}if(e){var o=t.getOption("gutters"),r=false;for(var i=0;i<o.length;++i)if(o[i]==m)r=true;var a=t.state.lint=new l(t,c(t,e),r);t.on("change",C);if(a.options.tooltips!=false)f.on(t.getWrapperElement(),"mouseover",a.onMouseOver);y(t)}})});