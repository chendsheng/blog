(function(t){if(typeof exports=="object"&&typeof module=="object")t(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],t);else t(CodeMirror)})(function(t){"use strict";t.defineExtension("annotateScrollbar",function(t){if(typeof t=="string")t={className:t};return new e(this,t)});t.defineOption("scrollButtonHeight",0);function e(t,e){this.cm=t;this.options=e;this.buttonHeight=e.scrollButtonHeight||t.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=t.getWrapperElement().appendChild(document.createElement("div"));this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();function i(t){clearTimeout(o.doRedraw);o.doRedraw=setTimeout(function(){o.redraw()},t)}var o=this;t.on("refresh",this.resizeHandler=function(){clearTimeout(o.doUpdate);o.doUpdate=setTimeout(function(){if(o.computeScale())i(20)},100)});t.on("markerAdded",this.resizeHandler);t.on("markerCleared",this.resizeHandler);if(e.listenForChanges!==false)t.on("change",this.changeHandler=function(){i(250)})}e.prototype.computeScale=function(){var t=this.cm;var e=(t.getWrapperElement().clientHeight-t.display.barHeight-this.buttonHeight*2)/t.heightAtLine(t.lastLine()+1,"local");if(e!=this.hScale){this.hScale=e;return true}};e.prototype.update=function(t){this.annotations=t;this.redraw()};e.prototype.redraw=function(t){if(t!==false)this.computeScale();var e=this.cm,i=this.hScale;var o=document.createDocumentFragment(),n=this.annotations;if(e.display.barWidth)for(var r=0,a;r<n.length;r++){var s=n[r];var h=a||e.charCoords(s.from,"local").top*i;var d=e.charCoords(s.to,"local").bottom*i;while(r<n.length-1){a=e.charCoords(n[r+1].from,"local").top*i;if(a>d+.9)break;s=n[++r];d=e.charCoords(s.to,"local").bottom*i}if(d==h)continue;var c=Math.max(d-h,3);var l=o.appendChild(document.createElement("div"));l.style.cssText="position: absolute; right: 0px; width: "+Math.max(e.display.barWidth-1,2)+"px; top: "+(h+this.buttonHeight)+"px; height: "+c+"px";l.className=this.options.className}this.div.textContent="";this.div.appendChild(o)};e.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);if(this.changeHandler)this.cm.off("change",this.changeHandler);this.div.parentNode.removeChild(this.div)}});