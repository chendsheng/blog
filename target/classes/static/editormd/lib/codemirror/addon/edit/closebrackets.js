(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(h){var l="()[]{}''\"\"";var s="'\"";var f="[]{}";var d=/\s/;var g=h.Pos;h.defineOption("autoCloseBrackets",false,function(e,n,t){if(t!=h.Init&&t)e.removeKeyMap("autoCloseBrackets");if(!n)return;var r=l,i=s,a=f;if(typeof n=="string")r=n;else if(typeof n=="object"){if(n.pairs!=null)r=n.pairs;if(n.triples!=null)i=n.triples;if(n.explode!=null)a=n.explode}var o=c(r,i);if(a)o.Enter=u(a);e.addKeyMap(o)});function o(e,n){var t=e.getRange(g(n.line,n.ch-1),g(n.line,n.ch+1));return t.length==2?t:null}function p(e,n,t){var r=e.getLine(n.line);var i=e.getTokenAt(n);if(/\bstring2?\b/.test(i.type))return false;var a=new h.StringStream(r.slice(0,n.ch)+t+r.slice(n.ch),4);a.pos=a.start=i.start;for(;;){var o=e.getMode().token(a,i.state);if(a.pos>=n.ch+1)return/\bstring2?\b/.test(o);a.start=a.pos}}function c(a,c){var e={name:"autoCloseBrackets",Backspace:function(e){if(e.getOption("disableInput"))return h.Pass;var n=e.listSelections();for(var t=0;t<n.length;t++){if(!n[t].empty())return h.Pass;var r=o(e,n[t].head);if(!r||a.indexOf(r)%2!=0)return h.Pass}for(var t=n.length-1;t>=0;t--){var i=n[t].head;e.replaceRange("",g(i.line,i.ch-1),g(i.line,i.ch+1))}}};var u="";for(var n=0;n<a.length;n+=2)(function(s,f){u+=f;e["'"+s+"'"]=function(t){if(t.getOption("disableInput"))return h.Pass;var e=t.listSelections(),r,n;for(var i=0;i<e.length;i++){var a=e[i],o=a.head,l;var n=t.getRange(o,g(o.line,o.ch+1));if(!a.empty()){l="surround"}else if(s==f&&n==f){if(t.getRange(o,g(o.line,o.ch+3))==s+s+s)l="skipThree";else l="skip"}else if(s==f&&o.ch>1&&c.indexOf(s)>=0&&t.getRange(g(o.line,o.ch-2),o)==s+s&&(o.ch<=2||t.getRange(g(o.line,o.ch-3),g(o.line,o.ch-2))!=s)){l="addFour"}else if(s=='"'||s=="'"){if(!h.isWordChar(n)&&p(t,o,s))l="both";else return h.Pass}else if(t.getLine(o.line).length==o.ch||u.indexOf(n)>=0||d.test(n)){l="both"}else{return h.Pass}if(!r)r=l;else if(r!=l)return h.Pass}t.operation(function(){if(r=="skip"){t.execCommand("goCharRight")}else if(r=="skipThree"){for(var e=0;e<3;e++)t.execCommand("goCharRight")}else if(r=="surround"){var n=t.getSelections();for(var e=0;e<n.length;e++)n[e]=s+n[e]+f;t.replaceSelections(n,"around")}else if(r=="both"){t.replaceSelection(s+f,null);t.execCommand("goCharLeft")}else if(r=="addFour"){t.replaceSelection(s+s+s+s,"before");t.execCommand("goCharRight")}})};if(s!=f)e["'"+f+"'"]=function(e){var n=e.listSelections();for(var t=0;t<n.length;t++){var r=n[t];if(!r.empty()||e.getRange(r.head,g(r.head.line,r.head.ch+1))!=f)return h.Pass}e.execCommand("goCharRight")}})(a.charAt(n),a.charAt(n+1));return e}function u(i){return function(t){if(t.getOption("disableInput"))return h.Pass;var r=t.listSelections();for(var e=0;e<r.length;e++){if(!r[e].empty())return h.Pass;var n=o(t,r[e].head);if(!n||i.indexOf(n)%2!=0)return h.Pass}t.operation(function(){t.replaceSelection("\n\n",null);t.execCommand("goCharLeft");r=t.listSelections();for(var e=0;e<r.length;e++){var n=r[e].head.line;t.indentLine(n,null,true);t.indentLine(n+1,null,true)}})}}});