(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";var O={};var M=/[^\s\u00a0]/;var y=e.Pos;function g(e){var n=e.search(M);return n==-1?0:n}e.commands.toggleComment=function(e){var n=Infinity,t=e.listSelections(),i=null;for(var l=t.length-1;l>=0;l--){var r=t[l].from(),a=t[l].to();if(r.line>=n)continue;if(a.line>=n)a=y(n,0);n=r.line;if(i==null){if(e.uncomment(r,a))i="un";else{e.lineComment(r,a);i="line"}}else if(i=="un"){e.uncomment(r,a)}else{e.lineComment(r,a)}}};e.defineExtension("lineComment",function(l,e,r){if(!r)r=O;var a=this,n=a.getModeAt(l);var o=r.lineComment||n.lineComment;if(!o){if(r.blockCommentStart||n.blockCommentStart){r.fullLines=true;a.blockComment(l,e,r)}return}var f=a.getLine(l.line);if(f==null)return;var c=Math.min(e.ch!=0||e.line==l.line?e.line+1:e.line,a.lastLine()+1);var m=r.padding==null?" ":r.padding;var s=r.commentBlankLines||l.line==e.line;a.operation(function(){if(r.indent){var e=f.slice(0,g(f));for(var n=l.line;n<c;++n){var t=a.getLine(n),i=e.length;if(!s&&!M.test(t))continue;if(t.slice(0,i)!=e)i=g(t);a.replaceRange(e+o+m,y(n,0),y(n,i))}}else{for(var n=l.line;n<c;++n){if(s||M.test(a.getLine(n)))a.replaceRange(o+m,y(n,0))}}})});e.defineExtension("blockComment",function(i,l,r){if(!r)r=O;var a=this,o=a.getModeAt(i);var f=r.blockCommentStart||o.blockCommentStart;var c=r.blockCommentEnd||o.blockCommentEnd;if(!f||!c){if((r.lineComment||o.lineComment)&&r.fullLines!=false)a.lineComment(i,l,r);return}var m=Math.min(l.line,a.lastLine());if(m!=i.line&&l.ch==0&&M.test(a.getLine(m)))--m;var s=r.padding==null?" ":r.padding;if(i.line>m)return;a.operation(function(){if(r.fullLines!=false){var e=M.test(a.getLine(m));a.replaceRange(s+c,y(m));a.replaceRange(f+s,y(i.line,0));var n=r.blockCommentLead||o.blockCommentLead;if(n!=null)for(var t=i.line+1;t<=m;++t)if(t!=m||e)a.replaceRange(n+s,y(t,0))}else{a.replaceRange(c,l);a.replaceRange(f,i)}})});e.defineExtension("uncomment",function(e,n,t){if(!t)t=O;var r=this,i=r.getModeAt(e);var a=Math.min(n.ch!=0||n.line==e.line?n.line:n.line-1,r.lastLine()),o=Math.min(e.line,a);var l=t.lineComment||i.lineComment,f=[];var c=t.padding==null?" ":t.padding,m;e:{if(!l)break e;for(var s=o;s<=a;++s){var g=r.getLine(s);var u=g.indexOf(l);if(u>-1&&!/comment/.test(r.getTokenTypeAt(y(s,u+1))))u=-1;if(u==-1&&(s!=a||s==o)&&M.test(g))break e;if(u>-1&&M.test(g.slice(0,u)))break e;f.push(g)}r.operation(function(){for(var e=o;e<=a;++e){var n=f[e-o];var t=n.indexOf(l),i=t+l.length;if(t<0)continue;if(n.slice(i,i+c.length)==c)i+=c.length;m=true;r.replaceRange("",y(e,t),y(e,i))}});if(m)return true}var v=t.blockCommentStart||i.blockCommentStart;var d=t.blockCommentEnd||i.blockCommentEnd;if(!v||!d)return false;var h=t.blockCommentLead||i.blockCommentLead;var p=r.getLine(o),C=a==o?p:r.getLine(a);var b=p.indexOf(v),k=C.lastIndexOf(d);if(k==-1&&o!=a){C=r.getLine(--a);k=C.lastIndexOf(d)}if(b==-1||k==-1||!/comment/.test(r.getTokenTypeAt(y(o,b+1)))||!/comment/.test(r.getTokenTypeAt(y(a,k+1))))return false;var L=p.lastIndexOf(v,e.ch);var x=L==-1?-1:p.slice(0,e.ch).indexOf(d,L+v.length);if(L!=-1&&x!=-1&&x+d.length!=e.ch)return false;x=C.indexOf(d,n.ch);var R=C.slice(n.ch).lastIndexOf(v,x-n.ch);L=x==-1||R==-1?-1:n.ch+R;if(x!=-1&&L!=-1&&L!=n.ch)return false;r.operation(function(){r.replaceRange("",y(a,k-(c&&C.slice(k-c.length,k)==c?c.length:0)),y(a,k+d.length));var e=b+v.length;if(c&&p.slice(e,e+c.length)==c)e+=c.length;r.replaceRange("",y(o,b),y(o,e));if(h)for(var n=o+1;n<=a;++n){var t=r.getLine(n),i=t.indexOf(h);if(i==-1||M.test(t.slice(0,i)))continue;var l=i+h.length;if(c&&t.slice(l,l+c.length)==c)l+=c.length;r.replaceRange("",y(n,i),y(n,l))}});return true})});