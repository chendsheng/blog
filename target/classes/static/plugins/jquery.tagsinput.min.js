!function(p){var u=new Array,o=new Array;p.fn.doAutosize=function(t){var a=p(this).data("minwidth"),e=p(this).data("maxwidth"),i="",n=p(this),r=p("#"+p(this).data("tester_id"));if(i!==(i=n.val())){var d=i.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");r.html(d);var u=r.width(),o=u+t.comfortZone>=a?u+t.comfortZone:a,s=n.width(),l=s>o&&o>=a||o>a&&e>o;l&&n.width(o)}},p.fn.resetAutosize=function(t){var a=p(this).data("minwidth")||t.minInputWidth||p(this).width(),e=p(this).data("maxwidth")||t.maxInputWidth||p(this).closest(".tagsinput").width()-t.inputPadding,i=p(this),n=p("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"}),r=p(this).attr("id")+"_autosize_tester";!p("#"+r).length>0&&(n.attr("id",r),n.appendTo("body")),i.data("minwidth",a),i.data("maxwidth",e),i.data("tester_id",r),i.css("width",a)},p.fn.addTag=function(r,d){return d=jQuery.extend({focus:!1,callback:!0},d),this.each(function(){var t=p(this).attr("id"),a=p(this).val().split(u[t]);if(""==a[0]&&(a=new Array),r=jQuery.trim(r),d.unique){var e=p(this).tagExist(r);1==e&&p("#"+t+"_tag").addClass("not_valid")}else var e=!1;if(""!=r&&1!=e){if(p("<span>").addClass("tag").append(p("<span>").text(r).append("&nbsp;&nbsp;"),p("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return p("#"+t).removeTag(escape(r))})).insertBefore("#"+t+"_addTag"),a.push(r),p("#"+t+"_tag").val(""),d.focus?p("#"+t+"_tag").focus():p("#"+t+"_tag").blur(),p.fn.tagsInput.updateTagsField(this,a),d.callback&&o[t]&&o[t].onAddTag){var i=o[t].onAddTag;i.call(this,r)}if(o[t]&&o[t].onChange){var n=a.length,i=o[t].onChange;i.call(this,p(this),a[n-1])}}}),!1},p.fn.removeTag=function(n){return n=unescape(n),this.each(function(){var t=p(this).attr("id"),a=p(this).val().split(u[t]);for(p("#"+t+"_tagsinput .tag").remove(),str="",i=0;i<a.length;i++)a[i]!=n&&(str=str+u[t]+a[i]);if(p.fn.tagsInput.importTags(this,str),o[t]&&o[t].onRemoveTag){var e=o[t].onRemoveTag;e.call(this,n)}}),!1},p.fn.tagExist=function(t){var a=p(this).attr("id"),e=p(this).val().split(u[a]);return jQuery.inArray(t,e)>=0},p.fn.importTags=function(t){var a=p(this).attr("id");p("#"+a+"_tagsinput .tag").remove(),p.fn.tagsInput.importTags(this,t)},p.fn.tagsInput=function(t){var n=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},t),e=0;return this.each(function(){if("undefined"==typeof p(this).attr("data-tagsinput-init")){p(this).attr("data-tagsinput-init",!0),n.hide&&p(this).hide();var i=p(this).attr("id");(!i||u[p(this).attr("id")])&&(i=p(this).attr("id","tags"+(new Date).getTime()+e++).attr("id"));var t=jQuery.extend({pid:i,real_input:"#"+i,holder:"#"+i+"_tagsinput",input_wrapper:"#"+i+"_addTag",fake_input:"#"+i+"_tag"},n);u[i]=t.delimiter,(n.onAddTag||n.onRemoveTag||n.onChange)&&(o[i]=new Array,o[i].onAddTag=n.onAddTag,o[i].onRemoveTag=n.onRemoveTag,o[i].onChange=n.onChange);var a='<div id="'+i+'_tagsinput" class="tagsinput"><div id="'+i+'_addTag">';if(n.interactive&&(a=a+'<input id="'+i+'_tag" value="" data-default="'+n.defaultText+'" />'),a+='</div><div class="tags_clear"></div></div>',p(a).insertAfter(this),p(t.holder).css("width",n.width),p(t.holder).css("min-height",n.height),p(t.holder).css("height",n.height),""!=p(t.real_input).val()&&p.fn.tagsInput.importTags(p(t.real_input),p(t.real_input).val()),n.interactive){if(p(t.fake_input).val(p(t.fake_input).attr("data-default")),p(t.fake_input).css("color",n.placeholderColor),p(t.fake_input).resetAutosize(n),p(t.holder).bind("click",t,function(t){p(t.data.fake_input).focus()}),p(t.fake_input).bind("focus",t,function(t){p(t.data.fake_input).val()==p(t.data.fake_input).attr("data-default")&&p(t.data.fake_input).val(""),p(t.data.fake_input).css("color","#000000")}),void 0!=n.autocomplete_url){autocomplete_options={source:n.autocomplete_url};for(attrname in n.autocomplete)autocomplete_options[attrname]=n.autocomplete[attrname];void 0!==jQuery.Autocompleter?(p(t.fake_input).autocomplete(n.autocomplete_url,n.autocomplete),p(t.fake_input).bind("result",t,function(t,a,e){a&&p("#"+i).addTag(a[0]+"",{focus:!0,unique:n.unique})})):void 0!==jQuery.ui.autocomplete&&(p(t.fake_input).autocomplete(autocomplete_options),p(t.fake_input).bind("autocompleteselect",t,function(t,a){return p(t.data.real_input).addTag(a.item.value,{focus:!0,unique:n.unique}),!1}))}else p(t.fake_input).bind("blur",t,function(t){var a=p(this).attr("data-default");return""!=p(t.data.fake_input).val()&&p(t.data.fake_input).val()!=a?t.data.minChars<=p(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=p(t.data.fake_input).val().length)&&p(t.data.real_input).addTag(p(t.data.fake_input).val(),{focus:!0,unique:n.unique}):(p(t.data.fake_input).val(p(t.data.fake_input).attr("data-default")),p(t.data.fake_input).css("color",n.placeholderColor)),!1});p(t.fake_input).bind("keypress",t,function(t){return r(t)?(t.preventDefault(),t.data.minChars<=p(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=p(t.data.fake_input).val().length)&&p(t.data.real_input).addTag(p(t.data.fake_input).val(),{focus:!0,unique:n.unique}),p(t.data.fake_input).resetAutosize(n),!1):void(t.data.autosize&&p(t.data.fake_input).doAutosize(n))}),t.removeWithBackspace&&p(t.fake_input).bind("keydown",function(t){if(8==t.keyCode&&""==p(this).val()){t.preventDefault();var a=p(this).closest(".tagsinput").find(".tag:last").text(),e=p(this).attr("id").replace(/_tag$/,"");a=a.replace(/[\s]+x$/,""),p("#"+e).removeTag(escape(a)),p(this).trigger("focus")}}),p(t.fake_input).blur(),t.unique&&p(t.fake_input).keydown(function(t){(8==t.keyCode||String.fromCharCode(t.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&p(this).removeClass("not_valid")})}}}),this},p.fn.tagsInput.updateTagsField=function(t,a){var e=p(t).attr("id");p(t).val(a.join(u[e]))},p.fn.tagsInput.importTags=function(t,a){p(t).val("");var e=p(t).attr("id"),n=a.split(u[e]);for(i=0;i<n.length;i++)p(t).addTag(n[i],{focus:!1,callback:!1});if(o[e]&&o[e].onChange){var r=o[e].onChange;r.call(t,t,n[i])}};var r=function(e){var i=!1;return 13==e.which?!0:("string"==typeof e.data.delimiter?e.which==e.data.delimiter.charCodeAt(0)&&(i=!0):p.each(e.data.delimiter,function(t,a){e.which==a.charCodeAt(0)&&(i=!0)}),i)}}(jQuery);