(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(o){"use strict";var g=o.Pos;function i(h,l,e,t){this.atOccurrence=false;this.doc=h;if(t==null&&typeof l=="string")t=false;e=e?h.clipPos(e):g(0,0);this.pos={from:e,to:e};if(typeof l!="string"){if(!l.global)l=new RegExp(l.source,l.ignoreCase?"ig":"g");this.matches=function(e,t){if(e){l.lastIndex=0;var n=h.getLine(t.line).slice(0,t.ch),i=0,r,o;for(;;){l.lastIndex=i;var s=l.exec(n);if(!s)break;r=s;o=r.index;i=r.index+(r[0].length||1);if(i==n.length)break}var f=r&&r[0].length||0;if(!f){if(o==0&&n.length==0){r=undefined}else if(o!=h.getLine(t.line).length){f++}}}else{l.lastIndex=t.ch;var n=h.getLine(t.line),r=l.exec(n);var f=r&&r[0].length||0;var o=r&&r.index;if(o+f!=n.length&&!f)f=1}if(r&&f)return{from:g(t.line,o),to:g(t.line,o+f),match:r}}}else{var o=l;if(t)l=l.toLowerCase();var c=t?function(e){return e.toLowerCase()}:function(e){return e};var a=l.split("\n");if(a.length==1){if(!l.length){this.matches=function(){}}else{this.matches=function(e,t){if(e){var n=h.getLine(t.line).slice(0,t.ch),i=c(n);var r=i.lastIndexOf(l);if(r>-1){r=s(n,i,r);return{from:g(t.line,r),to:g(t.line,r+o.length)}}}else{var n=h.getLine(t.line).slice(t.ch),i=c(n);var r=i.indexOf(l);if(r>-1){r=s(n,i,r)+t.ch;return{from:g(t.line,r),to:g(t.line,r+o.length)}}}}}}else{var u=o.split("\n");this.matches=function(e,t){var n=a.length-1;if(e){if(t.line-(a.length-1)<h.firstLine())return;if(c(h.getLine(t.line).slice(0,u[n].length))!=a[a.length-1])return;var i=g(t.line,u[n].length);for(var r=t.line-1,o=n-1;o>=1;--o,--r)if(a[o]!=c(h.getLine(r)))return;var s=h.getLine(r),f=s.length-u[0].length;if(c(s.slice(f))!=a[0])return;return{from:g(r,f),to:i}}else{if(t.line+(a.length-1)>h.lastLine())return;var s=h.getLine(t.line),f=s.length-u[0].length;if(c(s.slice(f))!=a[0])return;var l=g(t.line,f);for(var r=t.line+1,o=1;o<n;++o,++r)if(a[o]!=c(h.getLine(r)))return;if(c(h.getLine(r).slice(0,u[n].length))!=a[n])return;return{from:l,to:g(r,u[n].length)}}}}}}i.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(e){var n=this,t=this.doc.clipPos(e?this.pos.from:this.pos.to);function i(e){var t=g(e,0);n.pos={from:t,to:t};n.atOccurrence=false;return false}for(;;){if(this.pos=this.matches(e,t)){this.atOccurrence=true;return this.pos.match||true}if(e){if(!t.line)return i(0);t=g(t.line-1,this.doc.getLine(t.line-1).length)}else{var r=this.doc.lineCount();if(t.line==r-1)return i(r);t=g(t.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e){if(!this.atOccurrence)return;var t=o.splitLines(e);this.doc.replaceRange(t,this.pos.from,this.pos.to);this.pos.to=g(this.pos.from.line+t.length-1,t[t.length-1].length+(t.length==1?this.pos.from.ch:0))}};function s(e,t,n){if(e.length==t.length)return n;for(var i=Math.min(n,e.length);;){var r=e.slice(0,i).toLowerCase().length;if(r<n)++i;else if(r>n)--i;else return i}}o.defineExtension("getSearchCursor",function(e,t,n){return new i(this.doc,e,t,n)});o.defineDocExtension("getSearchCursor",function(e,t,n){return new i(this,e,t,n)});o.defineExtension("selectMatches",function(e,t){var n=[],i;var r=this.getSearchCursor(e,this.getCursor("from"),t);while(i=r.findNext()){if(o.cmpPos(r.to(),this.getCursor("to"))>0)break;n.push({anchor:r.from(),head:r.to()})}if(n.length)this.setSelections(n,0)})});