(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";e.defineMode("velocity",function(){function e(e){var t={},r=e.split(" ");for(var n=0;n<r.length;++n)t[r[n]]=true;return t}var i=e("#end #else #break #stop #[[ #]] "+"#{end} #{else} #{break} #{stop}");var l=e("#if #elseif #foreach #set #include #parse #macro #define #evaluate "+"#{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}");var s=e("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent");var o=/[+\-*&%=<>!?:\/|]/;function f(e,t,r){t.tokenize=r;return r(e,t)}function u(e,t){var r=t.beforeParams;t.beforeParams=false;var n=e.next();if(n=="'"&&t.inParams){t.lastTokenWasBuiltin=false;return f(e,t,c(n))}else if(n=='"'){t.lastTokenWasBuiltin=false;if(t.inString){t.inString=false;return"string"}else if(t.inParams)return f(e,t,c(n))}else if(/[\[\]{}\(\),;\.]/.test(n)){if(n=="("&&r)t.inParams=true;else if(n==")"){t.inParams=false;t.lastTokenWasBuiltin=true}return null}else if(/\d/.test(n)){t.lastTokenWasBuiltin=false;e.eatWhile(/[\w\.]/);return"number"}else if(n=="#"&&e.eat("*")){t.lastTokenWasBuiltin=false;return f(e,t,k)}else if(n=="#"&&e.match(/ *\[ *\[/)){t.lastTokenWasBuiltin=false;return f(e,t,m)}else if(n=="#"&&e.eat("#")){t.lastTokenWasBuiltin=false;e.skipToEnd();return"comment"}else if(n=="$"){e.eatWhile(/[\w\d\$_\.{}]/);if(s&&s.propertyIsEnumerable(e.current())){return"keyword"}else{t.lastTokenWasBuiltin=true;t.beforeParams=true;return"builtin"}}else if(o.test(n)){t.lastTokenWasBuiltin=false;e.eatWhile(o);return"operator"}else{e.eatWhile(/[\w\$_{}@]/);var a=e.current();if(i&&i.propertyIsEnumerable(a))return"keyword";if(l&&l.propertyIsEnumerable(a)||e.current().match(/^#@?[a-z0-9_]+ *$/i)&&e.peek()=="("&&!(l&&l.propertyIsEnumerable(a.toLowerCase()))){t.beforeParams=true;t.lastTokenWasBuiltin=false;return"keyword"}if(t.inString){t.lastTokenWasBuiltin=false;return"string"}if(e.pos>a.length&&e.string.charAt(e.pos-a.length-1)=="."&&t.lastTokenWasBuiltin)return"builtin";t.lastTokenWasBuiltin=false;return null}}function c(i){return function(e,t){var r=false,n,a=false;while((n=e.next())!=null){if(n==i&&!r){a=true;break}if(i=='"'&&e.peek()=="$"&&!r){t.inString=true;a=true;break}r=!r&&n=="\\"}if(a)t.tokenize=u;return"string"}}function k(e,t){var r=false,n;while(n=e.next()){if(n=="#"&&r){t.tokenize=u;break}r=n=="*"}return"comment"}function m(e,t){var r=0,n;while(n=e.next()){if(n=="#"&&r==2){t.tokenize=u;break}if(n=="]")r++;else if(n!=" ")r=0}return"meta"}return{startState:function(){return{tokenize:u,beforeParams:false,inParams:false,inString:false,lastTokenWasBuiltin:false}},token:function(e,t){if(e.eatSpace())return null;return t.tokenize(e,t)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}});e.defineMIME("text/velocity","velocity")});