(function(e){"use strict";if(typeof exports==="object"&&typeof module==="object")e(require("../../lib/codemirror"));else if(typeof define==="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";var t;e.defineOption("searchbox",false,function(e){e.addKeyMap({"Ctrl-F":function(){if(!t)t=new n(e);t.show()},Esc:function(){if(t&&t.isVisible()){t.hide();if(typeof event!=="undefined")event.stopPropagation()}return false},"Cmd-F":function(){if(!t)t=new n(e);t.show()}})});function n(A){var g=this;e();function t(e){g.searchBox=e.querySelector(".ace_search_form");g.replaceBox=e.querySelector(".ace_replace_form");g.searchOptions=e.querySelector(".ace_search_options");g.regExpOption=e.querySelector("[action=toggleRegexpMode]");g.caseSensitiveOption=e.querySelector("[action=toggleCaseSensitive]");g.wholeWordOption=e.querySelector("[action=toggleWholeWords]");g.searchInput=g.searchBox.querySelector(".ace_search_field");g.replaceInput=g.replaceBox.querySelector(".ace_search_field")}function e(){var e=g.element=i();o();t(e);n();e.addEventListener("mousedown",function(e){setTimeout(function(){g.activeInput.focus()},0);e.stopPropagation()});e.addEventListener("click",function(e){var t=e.target||e.srcElement;var n=t.getAttribute("action");if(n&&g[n])g[n]();else if(g.commands[n])g.commands[n]();e.stopPropagation()});g.searchInput.addEventListener("input",function(){g.$onChange.schedule(20)});g.searchInput.addEventListener("focus",function(){g.activeInput=g.searchInput});g.replaceInput.addEventListener("focus",function(){g.activeInput=g.replaceInput});g.$onChange=r(function(){g.find(false,false)})}function n(){var t=g,o={"Ctrl-F|Cmd-F|Ctrl-H|Command-Alt-F":function(){var e=t.isReplace=!t.isReplace;t.replaceBox.style.display=e?"":"none";t[e?"replaceInput":"searchInput"].focus()},"Ctrl-G|Cmd-G":function(){t.findNext()},"Ctrl-Shift-G|Cmd-Shift-G":function(){t.findPrev()},Esc:function(){setTimeout(function(){t.hide()})},Enter:function(){if(t.activeInput===t.replaceInput)t.replace();t.findNext()},"Shift-Enter":function(){if(t.activeInput===t.replaceInput)t.replace();t.findPrev()},"Alt-Enter":function(){if(t.activeInput===t.replaceInput)t.replaceAll();t.findAll()},Tab:function(){if(g.activeInput===g.replaceInput)g.searchInput.focus();else g.replaceInput.focus()}};g.element.addEventListener("keydown",function(n){Object.keys(o).some(function(e){var t=c(e,n);if(t){n.stopPropagation();n.preventDefault();o[e](n)}return t})})}this.commands={toggleRegexpMode:function(){g.regExpOption.checked=!g.regExpOption.checked;g.$syncOptions()},toggleCaseSensitive:function(){g.caseSensitiveOption.checked=!g.caseSensitiveOption.checked;g.$syncOptions()},toggleWholeWords:function(){g.wholeWordOption.checked=!g.wholeWordOption.checked;g.$syncOptions()}};this.$syncOptions=function(){v(this.regExpOption,"checked",this.regExpOption.checked);v(this.wholeWordOption,"checked",this.wholeWordOption.checked);v(this.caseSensitiveOption,"checked",this.caseSensitiveOption.checked);this.find(false,false)};this.find=function(e,t){var n=this.searchInput.value,o={skipCurrent:e,backwards:t,regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked};x(n,o,function(e){var t=e.matches(false,e.from());A.setSelection(t.from,t.to)})};function x(e,t,n){var o,i,r,c,a,s,l,u,d=t,p=true,h=d.caseSensitive,f=d.regExp,b=d.wholeWord;if(f||b){if(t.wholeWord)e="\\b"+e+"\\b";e=RegExp(e)}if(d.backwards)u=d.skipCurrent?"from":"to";else u=d.skipCurrent?"to":"from";l=A.getCursor(u);r=A.getSearchCursor(e,l,!h);c=r.findNext.bind(r),a=r.findPrevious.bind(r),s=r.matches.bind(r);if(d.backwards&&!a()){p=c();if(p){A.setCursor(A.doc.size-1,0);x(true,true,n);o=true}}else if(!d.backwards&&!c()){p=a();if(p){A.setCursor(0,0);x(true,false,n);o=true}}i=!p&&g.searchInput.value;v(g.searchBox,"ace_nomatch",i);if(!o&&p)n(r)}this.findNext=function(){this.find(true,false)};this.findPrev=function(){this.find(true,true)};this.findAll=function(){var e=this.searchInput.value,t,n=!t&&this.searchInput.value;v(this.searchBox,"ace_nomatch",n);if(A.showMatchesOnScrollbar)A.showMatchesOnScrollbar(e);this.hide()};this.replace=function(){if(!A.getOption("readOnly"))A.replaceSelection(this.replaceInput.value,"start")};this.replaceAndFindNext=function(){if(!A.getOption("readOnly")){this.editor.replace(this.replaceInput.value);this.findNext()}};this.replaceAll=function(){var e,t,n=this.searchInput.value,o=this.replaceInput.value,i=RegExp(n,"g");if(!A.getOption("readOnly")){t=A.getCursor();e=A.getValue();e=e.replace(i,o);A.setValue(e);A.setCursor(t)}};this.hide=function(){this.element.style.display="none";A.focus()};this.isVisible=function(){var e=this.element.style.display==="";return e};this.show=function(e,t){this.element.style.display="";this.replaceBox.style.display=t?"":"none";this.isReplace=t;if(e)this.searchInput.value=e;this.searchInput.focus();this.searchInput.select()};this.isFocused=function(){var e=document.activeElement;return e===this.searchInput||e===this.replaceInput};function o(){var e=document.createElement("style"),t=[".ace_search {","background-color: #ddd;","border: 1px solid #cbcbcb;","border-top: 0 none;","max-width: 325px;","overflow: hidden;","margin: 0;","padding: 4px;","padding-right: 6px;","padding-bottom: 0;","position: absolute;","top: 0px;","z-index: 99;","white-space: normal;","}",".ace_search.left {","border-left: 0 none;","border-radius: 0px 0px 5px 0px;","left: 0;","}",".ace_search.right {","border-radius: 0px 0px 0px 5px;","border-right: 0 none;","right: 0;","}",".ace_search_form, .ace_replace_form {","border-radius: 3px;","border: 1px solid #cbcbcb;","float: left;","margin-bottom: 4px;","overflow: hidden;","}",".ace_search_form.ace_nomatch {","outline: 1px solid red;","}",".ace_search_field {","background-color: white;","border-right: 1px solid #cbcbcb;","border: 0 none;","-webkit-box-sizing: border-box;","-moz-box-sizing: border-box;","box-sizing: border-box;","float: left;","height: 22px;","outline: 0;","padding: 0 7px;","width: 214px;","margin: 0;","}",".ace_searchbtn,",".ace_replacebtn {","background: #fff;","border: 0 none;","border-left: 1px solid #dcdcdc;","cursor: pointer;","float: left;","height: 22px;","margin: 0;","padding: 0;","position: relative;","}",".ace_searchbtn:last-child,",".ace_replacebtn:last-child {","border-top-right-radius: 3px;","border-bottom-right-radius: 3px;","}",".ace_searchbtn:disabled {","background: none;","cursor: default;","}",".ace_searchbtn {","background-position: 50% 50%;","background-repeat: no-repeat;","width: 27px;","}",".ace_searchbtn.prev {","background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADFJREFUeNpiSU1NZUAC/6E0I0yACYskCpsJiySKIiY0SUZk40FyTEgCjGgKwTRAgAEAQJUIPCE+qfkAAAAASUVORK5CYII=);    ","}",".ace_searchbtn.next {","background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADRJREFUeNpiTE1NZQCC/0DMyIAKwGJMUAYDEo3M/s+EpvM/mkKwCQxYjIeLMaELoLMBAgwAU7UJObTKsvAAAAAASUVORK5CYII=);    ","}",".ace_searchbtn_close {","background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAcCAYAAABRVo5BAAAAZ0lEQVR42u2SUQrAMAhDvazn8OjZBilCkYVVxiis8H4CT0VrAJb4WHT3C5xU2a2IQZXJjiQIRMdkEoJ5Q2yMqpfDIo+XY4k6h+YXOyKqTIj5REaxloNAd0xiKmAtsTHqW8sR2W5f7gCu5nWFUpVjZwAAAABJRU5ErkJggg==) no-repeat 50% 0;","border-radius: 50%;","border: 0 none;","color: #656565;","cursor: pointer;","float: right;","font: 16px/16px Arial;","height: 14px;","margin: 5px 1px 9px 5px;","padding: 0;","text-align: center;","width: 14px;","}",".ace_searchbtn_close:hover {","background-color: #656565;","background-position: 50% 100%;","color: white;","}",".ace_replacebtn.prev {","width: 54px","}",".ace_replacebtn.next {","width: 27px","}",".ace_button {","margin-left: 2px;","cursor: pointer;","-webkit-user-select: none;","-moz-user-select: none;","-o-user-select: none;","-ms-user-select: none;","user-select: none;","overflow: hidden;","opacity: 0.7;","border: 1px solid rgba(100,100,100,0.23);","padding: 1px;","-moz-box-sizing: border-box;","box-sizing:    border-box;","color: black;","}",".ace_button:hover {","background-color: #eee;","opacity:1;","}",".ace_button:active {","background-color: #ddd;","}",".ace_button.checked {","border-color: #3399ff;","opacity:1;","}",".ace_search_options{","margin-bottom: 3px;","text-align: right;","-webkit-user-select: none;","-moz-user-select: none;","-o-user-select: none;","-ms-user-select: none;","user-select: none;","}"].join("");e.setAttribute("data-name","js-searchbox");e.textContent=t;document.head.appendChild(e)}function i(){var e,t=document.querySelector(".CodeMirror"),n=document.createElement("div"),o=['<div class="ace_search right">','<button type="button" action="hide" class="ace_searchbtn_close"></button>','<div class="ace_search_form">','<input class="ace_search_field" placeholder="Search for" spellcheck="false"></input>','<button type="button" action="findNext" class="ace_searchbtn next"></button>','<button type="button" action="findPrev" class="ace_searchbtn prev"></button>','<button type="button" action="findAll" class="ace_searchbtn" title="Alt-Enter">All</button>',"</div>",'<div class="ace_replace_form">','<input class="ace_search_field" placeholder="Replace with" spellcheck="false"></input>','<button type="button" action="replaceAndFindNext" class="ace_replacebtn">Replace</button>','<button type="button" action="replaceAll" class="ace_replacebtn">All</button>',"</div>",'<div class="ace_search_options">','<span action="toggleRegexpMode" class="ace_button" title="RegExp Search">.*</span>','<span action="toggleCaseSensitive" class="ace_button" title="CaseSensitive Search">Aa</span>','<span action="toggleWholeWords" class="ace_button" title="Whole Word Search">\\b</span>',"</div>","</div>"].join("");n.innerHTML=o;e=n.firstChild;t.parentElement.appendChild(e);return e}}function v(e,t,n){var o=e.classList;o[n?"add":"remove"](t)}function r(e,t){var n,o=function(){n=null;e()},i=function(e){if(!n)n=setTimeout(o,e||t)};i.delay=function(e){n&&clearTimeout(n);n=setTimeout(o,e||t)};i.schedule=i;i.call=function(){this.cancel();e()};i.cancel=function(){n&&clearTimeout(n);n=null};i.isPending=function(){return n};return i}function c(e,i){var t,r={BACKSPACE:8,TAB:9,ENTER:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,UP:38,DOWN:40,INSERT:45,DELETE:46,INSERT_MAC:96,ASTERISK:106,PLUS:107,MINUS:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,SLASH:191,TRA:192,BACKSLASH:220};o(e,i);t=e.split("|").some(function(e){var t;t=e.split("-").some(function(n){var o;switch(n){case"Ctrl":o=i.ctrlKey;break;case"Shift":o=i.shiftKey;break;case"Alt":o=i.altKey;break;case"Cmd":o=i.metaKey;break;default:if(n.length===1)o=i.keyCode===n.charCodeAt(0);else Object.keys(r).some(function(e){var t=n.toUpperCase();if(t===e)o=i.keyCode===r[e]});break}return!o});return!t});return t}function o(e,t){if(typeof e!=="string")throw Error("str should be string!");if(typeof t!=="object")throw Error("event should be object!")}});